use strict;
use warnings;
use Test::More tests => 8;
use AI::MXNet qw(mx);
use Data::Dumper;
sub test_inits
{
    mx->random->seed(0);

    my $arr = mx->nd->zeros([1,1,1,1]);
    my $MSRAPrelu = mx->init->MSRAPrelu;
    &{$MSRAPrelu}("upsampling", $arr);
    is_deeply($arr->aspdl->unpdl, [
          [
            [
              [
                '1'
              ]
            ]
          ]
        ]);

    &{$MSRAPrelu}("stn_loc_weight", $arr);
    is_deeply($arr->aspdl->unpdl,[
          [
            [
              [
                '0'
              ]
            ]
          ]
        ]);

    $arr = mx->nd->zeros([6]);
    &{$MSRAPrelu}("stn_loc_bias", $arr);
    is_deeply($arr->aspdl->unpdl, [
          '1',
          '0',
          '0',
          '0',
          '1',
          '0'
        ]);

    $arr = mx->nd->zeros([5,5]);
    &{$MSRAPrelu}("weight", $arr);
    is_deeply($arr->aspdl->unpdl, [
          [
            '1.35734784603119',
            '0.713632524013519',
            '0.474907070398331',
            '0.296848952770233',
            '0.640225827693939'
          ],
          [
            '0.183803752064705',
            '0.726423561573029',
            '0.0938921421766281',
            '1.16070115566254',
            '-0.717151999473572'
          ],
          [
            '-0.75760281085968',
            '0.955988824367523',
            '-1.08665382862091',
            '-0.334976315498352',
            '-0.276956856250763'
          ],
          [
            '-1.44534838199615',
            '0.355493515729904',
            '0.332212537527084',
            '-1.13883996009827',
            '1.64345669746399'
          ],
          [
            '-1.2129579782486',
            '0.769808530807495',
            '-0.127634763717651',
            '-0.336712330579758',
            '0.14997036755085'
          ]
        ]);

    my $Xavier = mx->init->Xavier;
    &{$Xavier}("weight", $arr);
    is_deeply($arr->aspdl->unpdl, [
          [
            '-0.0287845302373171',
            '-0.104815199971199',
            '-0.37780949473381',
            '0.292202085256577',
            '-0.0175192635506392'
          ],
          [
            '0.317712008953094',
            '0.445094227790833',
            '0.442502468824387',
            '1.13565647602081',
            '-2.13630867004395'
          ],
          [
            '0.531598269939423',
            '0.833682954311371',
            '0.274951636791229',
            '-0.475705057382584',
            '0.83127361536026'
          ],
          [
            '1.41810441017151',
            '0.0930868536233902',
            '-0.888312518596649',
            '-0.752218782901764',
            '0.0417027026414871'
          ],
          [
            '-0.600852072238922',
            '-1.94228613376617',
            '-0.610550761222839',
            '-0.458290010690689',
            '0.574574708938599'
          ]
        ]);

    my $Uniform = mx->init->Uniform;
    &{$Uniform}("weight", $arr);
    is_deeply($arr->aspdl->unpdl, [
          [
            '-0.0613895654678345',
            '-0.396829515695572',
            '0.0958074927330017',
            '-0.510694563388824',
            '-0.673694252967834'
          ],
          [
            '-0.24620258808136',
            '0.164689660072327',
            '-0.49045518040657',
            '0.156934022903442',
            '-0.388750046491623'
          ],
          [
            '0.163707613945007',
            '-0.158915460109711',
            '0.621247231960297',
            '0.563637912273407',
            '0.254548370838165'
          ],
          [
            '-0.0700700283050537',
            '-0.196688950061798',
            '0.158288836479187',
            '-0.0881552696228027',
            '0.563288033008575'
          ],
          [
            '0.276683628559113',
            '-0.561007499694824',
            '-0.615684330463409',
            '0.657732665538788',
            '0.233473360538483'
          ]
        ]);

    my $Normal = mx->init->Normal;
    &{$Normal}("weight", $arr);
    is_deeply($arr->aspdl->unpdl, [
          [
            '0.0131429908797145',
            '0.0117952590808272',
            '-0.00479174545034766',
            '-0.00544482935220003',
            '-0.00895965006202459'
          ],
          [
            '-0.00342494412325323',
            '-0.00816253386437893',
            '0.0110863940790296',
            '-0.0161236394196749',
            '0.0127568580210209'
          ],
          [
            '0.00735556939616799',
            '-0.0183324348181486',
            '-0.000703656754922122',
            '-0.00528987217694521',
            '-0.0114661138504744'
          ],
          [
            '0.00601776456460357',
            '-0.0104387188330293',
            '0.00416262540966272',
            '-0.0153534589335322',
            '0.00509381107985973'
          ],
          [
            '-0.00952611025422812',
            '-0.0242135003209114',
            '-0.0162450112402439',
            '-0.00160829641390592',
            '-0.0106543703004718'
          ]
        ]);

    $arr = mx->nd->zeros([1,1,1]);
    my $Orthogonal = mx->init->Orthogonal;
    &{$Orthogonal}("weight", $arr);
    my $unpdl = $arr->aspdl->unpdl;
    $unpdl->[0][0][0] = lc $unpdl->[0][0][0]; ## perl 5.18 (-inf) perl 5.22 (-Inf)
    is_deeply($unpdl, [
          [
            [
              '-inf'
            ]
          ]
        ]);
}

test_inits();

